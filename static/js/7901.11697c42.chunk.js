"use strict";(self.webpackChunkidle_dashboard_new=self.webpackChunkidle_dashboard_new||[]).push([[7901,6624],{97901:function(e,t,n){n.r(t),n.d(t,{Deposit:function(){return j}});var a=n(74165),r=n(15861),i=n(29439),s=n(5128),l=n(54447),o=n(88935),u=n(61617),d=n(15542),c=n(1128),m=n(1669),v=n(43127),p=n(3498),x=n(7276),f=n(23023),g=n(78951),y=n(4710),A=n(66624),S=n(86393),h=n(7386),b=n(99594),Z=n(45263),j=function(e){var t=e.itemIndex,n=(0,x.useState)(""),j=(0,i.Z)(n,2),k=j[0],w=j[1],C=(0,x.useState)("0"),I=(0,i.Z)(C,2),E=I[0],P=I[1],D=(0,x.useState)(0),M=(0,i.Z)(D,2),T=M[0],B=M[1],U=(0,o.Y)().account,F=(0,y.useOperativeComponent)(),_=F.dispatch,L=F.activeItem,N=F.activeStep,G=F.executeAction,O=(0,f.R)(),V=O.sendTransaction,z=O.setGasLimit,R=O.state.transaction,W=(0,m.w)().selectors,X=W.selectAssetPriceUsd,H=W.selectAssetBalance,K=(0,h.useAssetProvider)(),Y=K.asset,$=K.vault,q=K.underlyingAsset,J=K.translate,Q=(0,x.useMemo)((function(){return H?H(null===q||void 0===q?void 0:q.id):(0,b.gA)(0)}),[H,null===q||void 0===q?void 0:q.id]),ee=(0,x.useMemo)((function(){return w(""),!(!(0,b.gA)(E).isNaN()&&!(0,b.gA)(E).lte(0))||!!(0,b.gA)(E).gt(Q)&&(w(J("trade.errors.insufficientFundsForAmount",{symbol:null===q||void 0===q?void 0:q.name})),!0)}),[E,Q,q,J]),te=(0,x.useCallback)((0,r.Z)((0,a.Z)().mark((function e(){var t,n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q&&$&&"getAllowanceContract"in $){e.next=2;break}return e.abrupt("return",(0,b.gA)(0));case 2:if(null!==U&&void 0!==U&&U.address){e.next=4;break}return e.abrupt("return",(0,b.gA)(0));case 4:if(t=$.getAllowanceContract()){e.next=7;break}return e.abrupt("return",(0,b.gA)(0));case 7:return n=(0,b.WP)($),e.next=10,(0,b.RC)(t,U.address,n);case 10:return r=e.sent,e.abrupt("return",(0,b.I0)(r,q.decimals));case 12:case"end":return e.stop()}}),e)}))),[q,$,null===U||void 0===U?void 0:U.address]),ne=(0,x.useCallback)((function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];U&&!ee&&$&&"getDepositContractSendMethod"in $&&"getDepositParams"in $&&(0,r.Z)((0,a.Z)().mark((function t(){var n,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,te();case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=(0,b.gA)(E);case 7:t.t0.gte(E)?(n=$.getDepositParams(E),r=$.getDepositContractSendMethod(n),V($.id,null===q||void 0===q?void 0:q.id,r)):_({type:"SET_ACTIVE_STEP",payload:1});case 9:case"end":return t.stop()}}),t)})))()}),[U,ee,E,$,q,_,te,V]);(0,x.useEffect)((function(){if(X&&q){var e=X(q.id),t=parseFloat((0,b.gA)(E).times(e).toString())||0;B(t)}}),[q,E,X,_]),(0,x.useEffect)((function(){G||N!==t||"success"!==R.status||P("")}),[G,R.status,N,t]);var ae=(0,x.useCallback)((function(){null!==q&&void 0!==q&&q.balance&&P(q.balance.toString())}),[q]),re=(0,x.useCallback)((0,r.Z)((0,a.Z)().mark((function e(){var t,n,r,i,l,o,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($&&"getDepositContractSendMethod"in $&&"getDepositParams"in $){e.next=2;break}return e.abrupt("return");case 2:return t=$.getMethodDefaultGasLimit("deposit"),e.next=5,te();case 5:if(n=e.sent,U&&!Q.lte(0)&&!n.lte(0)){e.next=8;break}return e.abrupt("return",t);case 8:return r=s.Z.minimum(Q,n),i={from:null===U||void 0===U?void 0:U.address},l=$.getDepositParams(r.toFixed()),o=$.getDepositContractSendMethod(l),e.next=14,(0,b.$K)(o,i);case 14:if(e.t0=e.sent,e.t0){e.next=17;break}e.t0=t;case 17:return u=e.t0,e.abrupt("return",u);case 19:case"end":return e.stop()}}),e)}))),[U,$,te,Q]);(0,x.useEffect)((function(){L===t&&(0,r.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re();case 2:t=e.sent,z(t);case 4:case"end":return e.stop()}}),e)})))()}),[L,t,re,z]),(0,x.useEffect)((function(){L===t&&(_({type:"SET_AMOUNT",payload:E}),_({type:"SET_DEFAULT_AMOUNT",payload:E}),_({type:"SET_ASSET",payload:q}),G&&(ne(!1),_({type:"SET_EXECUTE_ACTION",payload:!1})))}),[E,L,q,t,_,G,ne]);var ie=(0,x.useMemo)((function(){return U?(0,Z.jsx)(d.Translation,{component:v.zx,translation:"common.deposit",disabled:ee,onClick:ne,variant:"ctaFull"}):(0,Z.jsx)(S.ConnectWalletButton,{variant:"ctaFull"})}),[U,ee,ne]);return(0,Z.jsx)(h.AssetProvider,{flex:1,width:"100%",assetId:null===Y||void 0===Y?void 0:Y.underlyingId,children:(0,Z.jsxs)(p.gC,{pt:8,flex:1,spacing:6,height:"100%",id:"deposit-container",alignItems:"space-between",justifyContent:"flex-start",children:[(0,Z.jsxs)(p.gC,{flex:1,spacing:6,width:"100%",alignItems:"flex-start",children:[(0,Z.jsxs)(p.Ug,{spacing:4,width:"100%",alignItems:"flex-start",children:[(0,Z.jsx)(p.xu,{pt:8,children:(0,Z.jsx)(u.AssetLabel,{assetId:null===Y||void 0===Y?void 0:Y.id})}),(0,Z.jsxs)(p.gC,{spacing:1,width:"100%",alignItems:"flex-start",children:[(0,Z.jsx)(l.Card,{px:4,py:2,layerStyle:"cardLight",children:(0,Z.jsxs)(p.gC,{spacing:2,alignItems:"flex-start",children:[(0,Z.jsx)(c.InputAmount,{amount:E,amountUsd:T,setAmount:P}),(0,Z.jsxs)(p.Ug,{width:"100%",justifyContent:"space-between",children:[(0,Z.jsxs)(p.Ug,{spacing:1,children:[(0,Z.jsx)(d.Translation,{component:p.xv,translation:"common.balance",textStyle:"captionSmaller"}),(0,Z.jsx)(h.AssetProvider.Balance,{abbreviate:!0,decimals:4,textStyle:"captionSmaller",color:"primary"})]}),(0,Z.jsx)(v.zx,{variant:"selector",onClick:ae,children:"MAX"})]})]})}),k&&(0,Z.jsx)(p.xv,{textStyle:"captionSmaller",color:"orange",children:k})]})]}),$&&"status"in $&&$.status&&(0,Z.jsx)(l.Card.Dark,{p:2,border:0,children:(0,Z.jsx)(d.Translation,{textStyle:"captionSmaller",translation:"trade.actions.deposit.messages.".concat(null===$||void 0===$?void 0:$.status),textAlign:"center"})}),(0,Z.jsx)(A.DynamicActionFields,{assetId:null===Y||void 0===Y?void 0:Y.id,action:"deposit",amount:E,amountUsd:T})]}),(0,Z.jsxs)(p.gC,{spacing:4,id:"footer",alignItems:"flex-start",children:[(0,Z.jsx)(g.EstimatedGasFees,{}),ie]})]})})}},66624:function(e,t,n){n.r(t),n.d(t,{DynamicActionFields:function(){return f}});var a=n(1413),r=n(44925),i=n(5128),s=n(7276),l=n(12056),o=n(86059),u=n(99594),d=n(15542),c=n(1669),m=n(3498),v=n(45263),p=["assetId","field","amount","amountUsd","stakingPower"],x=function(e){var t,n,l,d,x,f=e.assetId,g=e.field,y=e.amount,A=e.amountUsd,S=e.stakingPower,h=(0,r.Z)(e,p),b=(0,c.w)(),Z=b.stakingData,j=b.helpers.vaultFunctionsHelper,k=b.selectors,w=k.selectAssetById,C=k.selectVaultById,I=k.selectVaultGauge,E=(0,s.useMemo)((function(){return f&&w&&w(f)}),[f,w]),P=(0,s.useMemo)((function(){return f&&C&&C(f)}),[f,C]),D=(0,s.useMemo)((function(){return f&&I&&I(f)}),[f,I]),M=(0,s.useMemo)((function(){return D&&w&&w(D.id)}),[D,w]),T=(0,s.useMemo)((function(){return(0,u.gA)(E.tvl).plus((0,u.d5)(y))}),[E,y]),B=(0,s.useMemo)((function(){return null===j||void 0===j?void 0:j.getVaultNewApr(E,P,(0,u.gA)(y))}),[E,P,y,j]),U=(0,s.useMemo)((function(){if((0,u.d5)(B).gt(0)){var e=(0,u.Bs)((0,u.d5)(B).div(100)).times(100),t=E.apyBreakdown?Object.keys(E.apyBreakdown||{}).filter((function(e){return"base"!==e})).reduce((function(e,t){switch(t){case"gauge":var n=null===M||void 0===M?void 0:M.gaugeData;if(n){var a=(0,u.d5)(null===n||void 0===n?void 0:n.totalSupply).plus((0,u.d5)(y)),r=(0,u.d5)(null===n||void 0===n?void 0:n.totalSupply).div(a),i=E.apyBreakdown[t].times(r);return e.plus(i)}return e.plus(E.apyBreakdown[t]);case"harvest":var s=(0,u.gA)(E.tvl).div(T),l=E.apyBreakdown[t].times(s);return e.plus(l);default:return e.plus(E.apyBreakdown[t])}}),(0,u.gA)(0)):(0,u.gA)(0);return(0,u.gA)(e).plus(t)}return(0,u.d5)(null===E||void 0===E?void 0:E.apy)}),[E,y,T,M,B]),F=(0,u.d5)(A).gt(0),_=(0,u.d5)(null===E||void 0===E||null===(t=E.vaultPosition)||void 0===t?void 0:t.underlying.redeemable),L=(0,u.d5)(null===E||void 0===E||null===(n=E.vaultPosition)||void 0===n?void 0:n.usd.redeemable),N=i.Z.maximum(0,(0,u.d5)(null===E||void 0===E||null===(l=E.vaultPosition)||void 0===l?void 0:l.usd.earnings)),G=i.Z.minimum(1,(0,u.d5)(A).div(L)),O=i.Z.minimum(N,G.times(N)),V=i.Z.maximum(0,(0,u.d5)(null===E||void 0===E||null===(d=E.vaultPosition)||void 0===d?void 0:d.usd.earnings).times(null===E||void 0===E?void 0:E.fee)),z=i.Z.minimum(V,(0,u.d5)(O).times(null===E||void 0===E?void 0:E.fee)),R=F&&(0,u.d5)(y).lte(_);switch(g){case"boost":var W=U&&null!==E&&void 0!==E&&null!==(x=E.baseApr)&&void 0!==x&&x.gt(0)?U.div(null===E||void 0===E?void 0:E.baseApr):(0,u.gA)(0);return(0,v.jsxs)(m.xv,(0,a.Z)((0,a.Z)({},h),{},{textStyle:"titleSmall",color:"primary",children:[W.toFixed(2),"x"]}));case"overperformance":var X=(0,u.d5)(A).times((0,u.gA)(null===E||void 0===E?void 0:E.baseApr).div(100)),H=(0,u.d5)(A).times((0,u.gA)(null===E||void 0===E?void 0:E.apy).div(100)),K=F?H.minus(X):null;return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:K,suffix:"/year"}));case"newApy":return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:U}));case"gain":return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:R?O:null}));case"fee":return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:R?z:null}));case"netGain":var Y=i.Z.minimum(N.minus(z),(0,u.d5)(O).minus(z));return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:R?Y:null}));case"coverage":var $=w(null===P||void 0===P?void 0:P.vaultConfig.Tranches.BB.address),q=$.tvl&&T?$.tvl.div(T).times(100):0;return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:q}));case"stakingPoolShare":if(!Z)return null;var J=(0,u.d5)(y).div(Z.stkIDLE.totalSupply.plus((0,u.d5)(y))).times(100);return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:J}));case"stkIDLE":case"stkIDLEAfterIncrease":return(0,v.jsx)(o.Amount,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary",suffix:" stkIDLE"},h),{},{value:y}));case"stakingApy":if(!Z)return null;var Q=(0,u.d5)(S).times(Z.maxApr);return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:Q}));default:return null}},f=function(e){var t,n=(0,c.w)().selectors.selectVaultById,r=e.assetId,i=e.action,o=(0,s.useMemo)((function(){return r&&n&&n(r)}),[r,n]),u=(0,s.useMemo)((function(){return(null===o||void 0===o?void 0:o.type)&&l.A[o.type]}),[o]);if(null===u||void 0===u||null===(t=u.dynamicActionFields)||void 0===t||!t[i])return null;var p=null===u||void 0===u?void 0:u.dynamicActionFields[i];return(0,v.jsx)(m.gC,{spacing:2,width:"100%",children:p.map((function(t){return(0,v.jsxs)(m.Ug,{pb:2,px:4,width:"100%",alignItems:"center",borderBottom:"1px solid",borderBottomColor:"divider",justifyContent:"space-between",children:[(0,v.jsx)(d.Translation,{component:m.xv,translation:"dynamicActionFields.".concat(t),textStyle:"captionSmall"}),(0,v.jsx)(x,(0,a.Z)((0,a.Z)({},e),{},{field:t}))]},"dynamicField_".concat(t))}))})}}}]);