"use strict";(self.webpackChunkidle_dashboard_new=self.webpackChunkidle_dashboard_new||[]).push([[7901,6624],{97901:function(e,t,n){n.r(t),n.d(t,{Deposit:function(){return E}});var a=n(74165),r=n(15861),i=n(29439),s=n(5128),l=n(54447),o=n(87099),u=n(4432),d=n(13708),c=n(88935),m=n(61617),v=n(15542),p=n(39177),f=n(1128),x=n(85267),g=n(1669),y=n(7276),A=n(23023),h=n(43127),S=n(3498),b=n(2092),j=n(78951),Z=n(4710),k=n(66624),w=n(86393),C=n(75712),I=n(99594),M=n(45263),E=function(e){var t=e.itemIndex,n=(0,y.useState)(""),E=(0,i.Z)(n,2),D=E[0],P=E[1],T=(0,y.useState)("0"),U=(0,i.Z)(T,2),B=U[0],F=U[1],_=(0,y.useState)(0),L=(0,i.Z)(_,2),N=L[0],z=L[1],G=(0,c.Y)().account,O=(0,x.m)().searchParams,V=(0,A.R)(),R=V.sendTransaction,W=V.setGasLimit,X=V.state.transaction,H=(0,g.w)().selectors,K=H.selectAssetPriceUsd,Y=H.selectAssetBalance,$=(0,C.useAssetProvider)(),q=$.asset,J=$.vault,Q=$.underlyingAsset,ee=$.translate,te=(0,Z.useOperativeComponent)(),ne=te.dispatch,ae=te.activeItem,re=te.activeStep,ie=te.executeAction,se=te.setActionIndex,le=(0,y.useMemo)((function(){return O}),[O]),oe=(0,i.Z)(le,1)[0],ue=(0,y.useMemo)((function(){var e;return J&&"flags"in J&&(null===(e=J.flags)||void 0===e?void 0:e.referralEnabled)}),[J]),de=(0,y.useMemo)((function(){if(ue){var e=oe.get("_referral");if((0,I.fF)(e)&&e!==o.r_)return e}}),[ue,oe]),ce=(0,y.useMemo)((function(){return Y?Y(null===Q||void 0===Q?void 0:Q.id):(0,I.gA)(0)}),[Y,null===Q||void 0===Q?void 0:Q.id]);(0,y.useEffect)((function(){if(K&&Q){var e=K(Q.id),t=parseFloat((0,I.gA)(B).times(e).toString())||0;z(t)}}),[Q,B,K,ne]),(0,y.useEffect)((function(){ie||re!==t||"success"!==X.status||F("")}),[ie,X.status,re,t]);var me=(0,y.useMemo)((function(){return J&&(!("enabled"in J)||J.enabled)}),[J]),ve=(0,y.useMemo)((function(){return P(""),!me||(!(!(0,I.gA)(B).isNaN()&&!(0,I.gA)(B).lte(0))||!!(0,I.gA)(B).gt(ce)&&(P(ee("trade.errors.insufficientFundsForAmount",{symbol:null===Q||void 0===Q?void 0:Q.name})),!0))}),[B,me,ce,Q,ee]),pe=(0,y.useCallback)((0,r.Z)((0,a.Z)().mark((function e(){var t,n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Q&&J&&"getAllowanceContract"in J){e.next=2;break}return e.abrupt("return",(0,I.gA)(0));case 2:if(null!==G&&void 0!==G&&G.address){e.next=4;break}return e.abrupt("return",(0,I.gA)(0));case 4:if(t=J.getAllowanceContract()){e.next=7;break}return e.abrupt("return",(0,I.gA)(0));case 7:return n=(0,I.WP)(J),e.next=10,(0,I.RC)(t,G.address,n);case 10:return r=e.sent,e.abrupt("return",(0,I.I0)(r,Q.decimals));case 12:case"end":return e.stop()}}),e)}))),[Q,J,null===G||void 0===G?void 0:G.address]),fe=(0,y.useCallback)((function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];G&&!ve&&J&&"getDepositContractSendMethod"in J&&"getDepositParams"in J&&(0,r.Z)((0,a.Z)().mark((function t(){var n,r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,pe();case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=(0,I.gA)(B);case 7:t.t0.gte(B)?(r=de&&"flags"in J&&null!==(n=J.flags)&&void 0!==n&&n.referralEnabled?J.getDepositParams(B,de):J.getDepositParams(B),i=J.getDepositContractSendMethod(r),(0,d.tM)(q,N),R(J.id,null===Q||void 0===Q?void 0:Q.id,i)):ne({type:"SET_ACTIVE_STEP",payload:1});case 9:case"end":return t.stop()}}),t)})))()}),[G,ve,de,B,N,J,q,Q,ne,pe,R]),xe=(0,y.useCallback)((function(){null!==Q&&void 0!==Q&&Q.balance&&F(Q.balance.toString())}),[Q]),ge=(0,y.useCallback)((0,r.Z)((0,a.Z)().mark((function e(){var t,n,r,i,l,o,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(J&&"getDepositContractSendMethod"in J&&"getDepositParams"in J){e.next=2;break}return e.abrupt("return");case 2:return t=J.getMethodDefaultGasLimit("deposit"),e.next=5,pe();case 5:if(n=e.sent,G&&!ce.lte(0)&&!n.lte(0)){e.next=8;break}return e.abrupt("return",t);case 8:return r=s.Z.minimum(ce,n),i={from:null===G||void 0===G?void 0:G.address},l=J.getDepositParams(r.toFixed()),o=J.getDepositContractSendMethod(l),e.next=14,(0,I.$K)(o,i);case 14:if(e.t0=e.sent,e.t0){e.next=17;break}e.t0=t;case 17:return u=e.t0,e.abrupt("return",u);case 19:case"end":return e.stop()}}),e)}))),[G,J,pe,ce]);(0,y.useEffect)((function(){ae===t&&(0,r.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge();case 2:t=e.sent,W(t);case 4:case"end":return e.stop()}}),e)})))()}),[ae,t,ge,W]),(0,y.useEffect)((function(){ae===t&&(ne({type:"SET_AMOUNT",payload:B}),ne({type:"SET_DEFAULT_AMOUNT",payload:B}),ne({type:"SET_ASSET",payload:Q}),ie&&(fe(!1),ne({type:"SET_EXECUTE_ACTION",payload:!1})))}),[B,ae,Q,t,ne,ie,fe]);var ye=(0,y.useMemo)((function(){return G?(0,M.jsx)(v.Translation,{component:h.zx,translation:"common.deposit",disabled:ve,onClick:fe,variant:"ctaFull"}):(0,M.jsx)(w.ConnectWalletButton,{variant:"ctaFull"})}),[G,ve,fe]),Ae=(0,y.useMemo)((function(){return de?(0,M.jsx)(l.Card.Dark,{py:2,pl:3,pr:2,border:0,children:(0,M.jsxs)(S.gC,{spacing:1,children:[(0,M.jsx)(v.Translation,{textStyle:"captionSmaller",translation:"defi.depositWithReferral"}),(0,M.jsx)(p.AddressLink,{address:de,text:de,fontSize:"sm"})]})}):null}),[de]),he=(0,y.useMemo)((function(){return!me&&ce.gt(0)?(0,M.jsx)(l.Card.Dark,{py:2,pl:3,pr:2,border:0,children:(0,M.jsxs)(S.Ug,{spacing:3,width:"full",children:[(0,M.jsx)(b.Ee,{src:"".concat(u.pm,"vaults/deprecated.png"),width:6,height:6}),(0,M.jsx)(v.Translation,{textStyle:"captionSmaller",translation:"trade.vaults.".concat(null===q||void 0===q?void 0:q.type,".disabled"),textAlign:"left"}),(0,M.jsx)(v.Translation,{component:h.zx,translation:"trade.vaults.".concat(null===q||void 0===q?void 0:q.type,".disabledCta"),fontSize:"xs",height:"auto",width:"auto",py:3,px:7,onClick:function(){return se(1)}})]})}):J&&"status"in J&&J.status&&(0,M.jsx)(l.Card.Dark,{p:2,border:0,children:(0,M.jsx)(v.Translation,{textStyle:"captionSmaller",translation:"trade.actions.deposit.messages.".concat(null===J||void 0===J?void 0:J.status),textAlign:"center"})})}),[q,J,me,ce,se]);return(0,M.jsx)(C.AssetProvider,{flex:1,width:"100%",assetId:null===q||void 0===q?void 0:q.underlyingId,children:(0,M.jsxs)(S.gC,{pt:8,flex:1,spacing:6,height:"100%",id:"deposit-container",alignItems:"space-between",justifyContent:"flex-start",children:[(0,M.jsxs)(S.gC,{flex:1,spacing:6,width:"100%",alignItems:"flex-start",children:[(0,M.jsxs)(S.Ug,{width:"100%",spacing:[3,4],alignItems:"flex-start",children:[(0,M.jsx)(S.xu,{pt:8,children:(0,M.jsx)(m.AssetLabel,{assetId:null===q||void 0===q?void 0:q.id})}),(0,M.jsxs)(S.gC,{spacing:1,width:"100%",alignItems:"flex-start",children:[(0,M.jsx)(l.Card,{px:4,py:2,layerStyle:"cardLight",children:(0,M.jsxs)(S.gC,{spacing:2,alignItems:"flex-start",children:[(0,M.jsx)(f.InputAmount,{amount:B,amountUsd:N,setAmount:F}),(0,M.jsxs)(S.Ug,{width:"100%",justifyContent:"space-between",children:[(0,M.jsxs)(S.Ug,{spacing:1,children:[(0,M.jsx)(v.Translation,{component:S.xv,translation:"common.balance",textStyle:"captionSmaller"}),(0,M.jsx)(C.AssetProvider.Balance,{abbreviate:!0,decimals:4,textStyle:"captionSmaller",color:"primary"})]}),(0,M.jsx)(h.zx,{variant:"selector",onClick:xe,children:"MAX"})]})]})}),D&&(0,M.jsx)(S.xv,{textStyle:"captionSmaller",color:"orange",children:D})]})]}),Ae,he,(0,M.jsx)(k.DynamicActionFields,{assetId:null===q||void 0===q?void 0:q.id,action:"deposit",amount:B,amountUsd:N})]}),(0,M.jsxs)(S.gC,{spacing:4,id:"footer",alignItems:"flex-start",children:[(0,M.jsx)(j.EstimatedGasFees,{}),ye]})]})})}},66624:function(e,t,n){n.r(t),n.d(t,{DynamicActionFields:function(){return x}});var a=n(1413),r=n(44925),i=n(5128),s=n(7276),l=n(12056),o=n(86059),u=n(99594),d=n(15542),c=n(1669),m=n(3498),v=n(45263),p=["assetId","field","amount","amountUsd","stakingPower"],f=function(e){var t,n,l,d,f,x=e.assetId,g=e.field,y=e.amount,A=e.amountUsd,h=e.stakingPower,S=(0,r.Z)(e,p),b=(0,c.w)(),j=b.stakingData,Z=b.helpers.vaultFunctionsHelper,k=b.selectors,w=k.selectAssetById,C=k.selectVaultById,I=k.selectVaultGauge,M=(0,s.useMemo)((function(){return x&&w&&w(x)}),[x,w]),E=(0,s.useMemo)((function(){return x&&C&&C(x)}),[x,C]),D=(0,s.useMemo)((function(){return x&&I&&I(x)}),[x,I]),P=(0,s.useMemo)((function(){return D&&w&&w(D.id)}),[D,w]),T=(0,s.useMemo)((function(){return(0,u.gA)(M.tvl).plus((0,u.d5)(y))}),[M,y]),U=(0,s.useMemo)((function(){return null===Z||void 0===Z?void 0:Z.getVaultNewApr(M,E,(0,u.gA)(y))}),[M,E,y,Z]),B=(0,s.useMemo)((function(){if((0,u.d5)(U).gt(0)){var e=(0,u.Bs)((0,u.d5)(U).div(100)).times(100),t=M.apyBreakdown?Object.keys(M.apyBreakdown||{}).filter((function(e){return"base"!==e})).reduce((function(e,t){switch(t){case"gauge":var n=null===P||void 0===P?void 0:P.gaugeData;if(n){var a=(0,u.d5)(null===n||void 0===n?void 0:n.totalSupply).plus((0,u.d5)(y)),r=(0,u.d5)(null===n||void 0===n?void 0:n.totalSupply).div(a),i=M.apyBreakdown[t].times(r);return e.plus(i)}return e.plus(M.apyBreakdown[t]);case"harvest":var s=(0,u.gA)(M.tvl).div(T),l=M.apyBreakdown[t].times(s);return e.plus(l);default:return e.plus(M.apyBreakdown[t])}}),(0,u.gA)(0)):(0,u.gA)(0);return(0,u.gA)(e).plus(t)}return(0,u.d5)(null===M||void 0===M?void 0:M.apy)}),[M,y,T,P,U]),F=(0,u.d5)(A).gt(0),_=(0,u.d5)(null===M||void 0===M||null===(t=M.vaultPosition)||void 0===t?void 0:t.underlying.redeemable),L=(0,u.d5)(null===M||void 0===M||null===(n=M.vaultPosition)||void 0===n?void 0:n.usd.redeemable),N=i.Z.maximum(0,(0,u.d5)(null===M||void 0===M||null===(l=M.vaultPosition)||void 0===l?void 0:l.usd.earnings)),z=i.Z.minimum(1,(0,u.d5)(A).div(L)),G=i.Z.minimum(N,z.times(N)),O=i.Z.maximum(0,(0,u.d5)(null===M||void 0===M||null===(d=M.vaultPosition)||void 0===d?void 0:d.usd.earnings).times(null===M||void 0===M?void 0:M.fee)),V=i.Z.minimum(O,(0,u.d5)(G).times(null===M||void 0===M?void 0:M.fee)),R=F&&(0,u.d5)(y).lte(_);switch(g){case"boost":var W=B&&null!==M&&void 0!==M&&null!==(f=M.baseApr)&&void 0!==f&&f.gt(0)?B.div(null===M||void 0===M?void 0:M.baseApr):(0,u.gA)(0);return(0,v.jsxs)(m.xv,(0,a.Z)((0,a.Z)({},S),{},{textStyle:"titleSmall",color:"primary",children:[W.toFixed(2),"x"]}));case"overperformance":var X=(0,u.d5)(A).times((0,u.gA)(null===M||void 0===M?void 0:M.baseApr).div(100)),H=(0,u.d5)(A).times((0,u.gA)(null===M||void 0===M?void 0:M.apy).div(100)),K=F?H.minus(X):null;return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},S),{},{value:K,suffix:"/year"}));case"newApy":return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},S),{},{value:B}));case"gain":return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},S),{},{value:R?G:null}));case"fee":return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},S),{},{value:R?V:null}));case"netGain":var Y=i.Z.minimum(N.minus(V),(0,u.d5)(G).minus(V));return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},S),{},{value:R?Y:null}));case"coverage":var $=w(null===E||void 0===E?void 0:E.vaultConfig.Tranches.BB.address),q=$.tvl&&T?$.tvl.div(T).times(100):0;return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},S),{},{value:q}));case"stakingPoolShare":if(!j)return null;var J=(0,u.d5)(y).div(j.stkIDLE.totalSupply.plus((0,u.d5)(y))).times(100);return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},S),{},{value:J}));case"stkIDLE":case"stkIDLEAfterIncrease":return(0,v.jsx)(o.Amount,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary",suffix:" stkIDLE"},S),{},{value:y}));case"stakingApy":if(!j)return null;var Q=(0,u.d5)(h).times(j.maxApr);return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},S),{},{value:Q}));default:return null}},x=function(e){var t,n=(0,c.w)().selectors.selectVaultById,r=e.assetId,i=e.action,o=(0,s.useMemo)((function(){return r&&n&&n(r)}),[r,n]),u=(0,s.useMemo)((function(){return(null===o||void 0===o?void 0:o.type)&&l.A[o.type]}),[o]);if(null===u||void 0===u||null===(t=u.dynamicActionFields)||void 0===t||!t[i])return null;var p=null===u||void 0===u?void 0:u.dynamicActionFields[i];return(0,v.jsx)(m.gC,{spacing:2,width:"100%",children:p.map((function(t){return(0,v.jsxs)(m.Ug,{pb:2,px:4,width:"100%",alignItems:"center",borderBottom:"1px solid",borderBottomColor:"divider",justifyContent:"space-between",children:[(0,v.jsx)(d.Translation,{component:m.xv,translation:"dynamicActionFields.".concat(t),textStyle:"captionSmall"}),(0,v.jsx)(f,(0,a.Z)((0,a.Z)({},e),{},{field:t}))]},"dynamicField_".concat(t))}))})}}}]);