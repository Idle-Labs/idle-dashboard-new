"use strict";(self.webpackChunkidle_dashboard_new=self.webpackChunkidle_dashboard_new||[]).push([[7901,6624],{97901:function(e,t,n){n.r(t),n.d(t,{Deposit:function(){return k}});var a=n(74165),r=n(15861),i=n(29439),s=n(5128),l=n(54447),o=n(13708),u=n(88935),d=n(61617),c=n(15542),m=n(1128),v=n(1669),p=n(43127),x=n(3498),f=n(7276),g=n(23023),y=n(78951),A=n(4710),S=n(66624),h=n(86393),b=n(7386),Z=n(99594),j=n(45263),k=function(e){var t=e.itemIndex,n=(0,f.useState)(""),k=(0,i.Z)(n,2),w=k[0],C=k[1],I=(0,f.useState)("0"),E=(0,i.Z)(I,2),M=E[0],P=E[1],D=(0,f.useState)(0),T=(0,i.Z)(D,2),B=T[0],U=T[1],F=(0,u.Y)().account,_=(0,A.useOperativeComponent)(),L=_.dispatch,N=_.activeItem,G=_.activeStep,O=_.executeAction,V=(0,g.R)(),z=V.sendTransaction,R=V.setGasLimit,W=V.state.transaction,X=(0,v.w)().selectors,H=X.selectAssetPriceUsd,K=X.selectAssetBalance,Y=(0,b.useAssetProvider)(),$=Y.asset,q=Y.vault,J=Y.underlyingAsset,Q=Y.translate,ee=(0,f.useMemo)((function(){return K?K(null===J||void 0===J?void 0:J.id):(0,Z.gA)(0)}),[K,null===J||void 0===J?void 0:J.id]);(0,f.useEffect)((function(){if(H&&J){var e=H(J.id),t=parseFloat((0,Z.gA)(M).times(e).toString())||0;U(t)}}),[J,M,H,L]),(0,f.useEffect)((function(){O||G!==t||"success"!==W.status||P("")}),[O,W.status,G,t]);var te=(0,f.useMemo)((function(){return C(""),!(!(0,Z.gA)(M).isNaN()&&!(0,Z.gA)(M).lte(0))||!!(0,Z.gA)(M).gt(ee)&&(C(Q("trade.errors.insufficientFundsForAmount",{symbol:null===J||void 0===J?void 0:J.name})),!0)}),[M,ee,J,Q]),ne=(0,f.useCallback)((0,r.Z)((0,a.Z)().mark((function e(){var t,n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(J&&q&&"getAllowanceContract"in q){e.next=2;break}return e.abrupt("return",(0,Z.gA)(0));case 2:if(null!==F&&void 0!==F&&F.address){e.next=4;break}return e.abrupt("return",(0,Z.gA)(0));case 4:if(t=q.getAllowanceContract()){e.next=7;break}return e.abrupt("return",(0,Z.gA)(0));case 7:return n=(0,Z.WP)(q),e.next=10,(0,Z.RC)(t,F.address,n);case 10:return r=e.sent,e.abrupt("return",(0,Z.I0)(r,J.decimals));case 12:case"end":return e.stop()}}),e)}))),[J,q,null===F||void 0===F?void 0:F.address]),ae=(0,f.useCallback)((function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];F&&!te&&q&&"getDepositContractSendMethod"in q&&"getDepositParams"in q&&(0,r.Z)((0,a.Z)().mark((function t(){var n,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,ne();case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=(0,Z.gA)(M);case 7:t.t0.gte(M)?(n=q.getDepositParams(M),r=q.getDepositContractSendMethod(n),(0,o.tM)($,B),z(q.id,null===J||void 0===J?void 0:J.id,r)):L({type:"SET_ACTIVE_STEP",payload:1});case 9:case"end":return t.stop()}}),t)})))()}),[F,te,M,B,q,$,J,L,ne,z]),re=(0,f.useCallback)((function(){null!==J&&void 0!==J&&J.balance&&P(J.balance.toString())}),[J]),ie=(0,f.useCallback)((0,r.Z)((0,a.Z)().mark((function e(){var t,n,r,i,l,o,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q&&"getDepositContractSendMethod"in q&&"getDepositParams"in q){e.next=2;break}return e.abrupt("return");case 2:return t=q.getMethodDefaultGasLimit("deposit"),e.next=5,ne();case 5:if(n=e.sent,F&&!ee.lte(0)&&!n.lte(0)){e.next=8;break}return e.abrupt("return",t);case 8:return r=s.Z.minimum(ee,n),i={from:null===F||void 0===F?void 0:F.address},l=q.getDepositParams(r.toFixed()),o=q.getDepositContractSendMethod(l),e.next=14,(0,Z.$K)(o,i);case 14:if(e.t0=e.sent,e.t0){e.next=17;break}e.t0=t;case 17:return u=e.t0,e.abrupt("return",u);case 19:case"end":return e.stop()}}),e)}))),[F,q,ne,ee]);(0,f.useEffect)((function(){N===t&&(0,r.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ie();case 2:t=e.sent,R(t);case 4:case"end":return e.stop()}}),e)})))()}),[N,t,ie,R]),(0,f.useEffect)((function(){N===t&&(L({type:"SET_AMOUNT",payload:M}),L({type:"SET_DEFAULT_AMOUNT",payload:M}),L({type:"SET_ASSET",payload:J}),O&&(ae(!1),L({type:"SET_EXECUTE_ACTION",payload:!1})))}),[M,N,J,t,L,O,ae]);var se=(0,f.useMemo)((function(){return F?(0,j.jsx)(c.Translation,{component:p.zx,translation:"common.deposit",disabled:te,onClick:ae,variant:"ctaFull"}):(0,j.jsx)(h.ConnectWalletButton,{variant:"ctaFull"})}),[F,te,ae]);return(0,j.jsx)(b.AssetProvider,{flex:1,width:"100%",assetId:null===$||void 0===$?void 0:$.underlyingId,children:(0,j.jsxs)(x.gC,{pt:8,flex:1,spacing:6,height:"100%",id:"deposit-container",alignItems:"space-between",justifyContent:"flex-start",children:[(0,j.jsxs)(x.gC,{flex:1,spacing:6,width:"100%",alignItems:"flex-start",children:[(0,j.jsxs)(x.Ug,{spacing:4,width:"100%",alignItems:"flex-start",children:[(0,j.jsx)(x.xu,{pt:8,children:(0,j.jsx)(d.AssetLabel,{assetId:null===$||void 0===$?void 0:$.id})}),(0,j.jsxs)(x.gC,{spacing:1,width:"100%",alignItems:"flex-start",children:[(0,j.jsx)(l.Card,{px:4,py:2,layerStyle:"cardLight",children:(0,j.jsxs)(x.gC,{spacing:2,alignItems:"flex-start",children:[(0,j.jsx)(m.InputAmount,{amount:M,amountUsd:B,setAmount:P}),(0,j.jsxs)(x.Ug,{width:"100%",justifyContent:"space-between",children:[(0,j.jsxs)(x.Ug,{spacing:1,children:[(0,j.jsx)(c.Translation,{component:x.xv,translation:"common.balance",textStyle:"captionSmaller"}),(0,j.jsx)(b.AssetProvider.Balance,{abbreviate:!0,decimals:4,textStyle:"captionSmaller",color:"primary"})]}),(0,j.jsx)(p.zx,{variant:"selector",onClick:re,children:"MAX"})]})]})}),w&&(0,j.jsx)(x.xv,{textStyle:"captionSmaller",color:"orange",children:w})]})]}),q&&"status"in q&&q.status&&(0,j.jsx)(l.Card.Dark,{p:2,border:0,children:(0,j.jsx)(c.Translation,{textStyle:"captionSmaller",translation:"trade.actions.deposit.messages.".concat(null===q||void 0===q?void 0:q.status),textAlign:"center"})}),(0,j.jsx)(S.DynamicActionFields,{assetId:null===$||void 0===$?void 0:$.id,action:"deposit",amount:M,amountUsd:B})]}),(0,j.jsxs)(x.gC,{spacing:4,id:"footer",alignItems:"flex-start",children:[(0,j.jsx)(y.EstimatedGasFees,{}),se]})]})})}},66624:function(e,t,n){n.r(t),n.d(t,{DynamicActionFields:function(){return f}});var a=n(1413),r=n(44925),i=n(5128),s=n(7276),l=n(12056),o=n(86059),u=n(99594),d=n(15542),c=n(1669),m=n(3498),v=n(45263),p=["assetId","field","amount","amountUsd","stakingPower"],x=function(e){var t,n,l,d,x,f=e.assetId,g=e.field,y=e.amount,A=e.amountUsd,S=e.stakingPower,h=(0,r.Z)(e,p),b=(0,c.w)(),Z=b.stakingData,j=b.helpers.vaultFunctionsHelper,k=b.selectors,w=k.selectAssetById,C=k.selectVaultById,I=k.selectVaultGauge,E=(0,s.useMemo)((function(){return f&&w&&w(f)}),[f,w]),M=(0,s.useMemo)((function(){return f&&C&&C(f)}),[f,C]),P=(0,s.useMemo)((function(){return f&&I&&I(f)}),[f,I]),D=(0,s.useMemo)((function(){return P&&w&&w(P.id)}),[P,w]),T=(0,s.useMemo)((function(){return(0,u.gA)(E.tvl).plus((0,u.d5)(y))}),[E,y]),B=(0,s.useMemo)((function(){return null===j||void 0===j?void 0:j.getVaultNewApr(E,M,(0,u.gA)(y))}),[E,M,y,j]),U=(0,s.useMemo)((function(){if((0,u.d5)(B).gt(0)){var e=(0,u.Bs)((0,u.d5)(B).div(100)).times(100),t=E.apyBreakdown?Object.keys(E.apyBreakdown||{}).filter((function(e){return"base"!==e})).reduce((function(e,t){switch(t){case"gauge":var n=null===D||void 0===D?void 0:D.gaugeData;if(n){var a=(0,u.d5)(null===n||void 0===n?void 0:n.totalSupply).plus((0,u.d5)(y)),r=(0,u.d5)(null===n||void 0===n?void 0:n.totalSupply).div(a),i=E.apyBreakdown[t].times(r);return e.plus(i)}return e.plus(E.apyBreakdown[t]);case"harvest":var s=(0,u.gA)(E.tvl).div(T),l=E.apyBreakdown[t].times(s);return e.plus(l);default:return e.plus(E.apyBreakdown[t])}}),(0,u.gA)(0)):(0,u.gA)(0);return(0,u.gA)(e).plus(t)}return(0,u.d5)(null===E||void 0===E?void 0:E.apy)}),[E,y,T,D,B]),F=(0,u.d5)(A).gt(0),_=(0,u.d5)(null===E||void 0===E||null===(t=E.vaultPosition)||void 0===t?void 0:t.underlying.redeemable),L=(0,u.d5)(null===E||void 0===E||null===(n=E.vaultPosition)||void 0===n?void 0:n.usd.redeemable),N=i.Z.maximum(0,(0,u.d5)(null===E||void 0===E||null===(l=E.vaultPosition)||void 0===l?void 0:l.usd.earnings)),G=i.Z.minimum(1,(0,u.d5)(A).div(L)),O=i.Z.minimum(N,G.times(N)),V=i.Z.maximum(0,(0,u.d5)(null===E||void 0===E||null===(d=E.vaultPosition)||void 0===d?void 0:d.usd.earnings).times(null===E||void 0===E?void 0:E.fee)),z=i.Z.minimum(V,(0,u.d5)(O).times(null===E||void 0===E?void 0:E.fee)),R=F&&(0,u.d5)(y).lte(_);switch(g){case"boost":var W=U&&null!==E&&void 0!==E&&null!==(x=E.baseApr)&&void 0!==x&&x.gt(0)?U.div(null===E||void 0===E?void 0:E.baseApr):(0,u.gA)(0);return(0,v.jsxs)(m.xv,(0,a.Z)((0,a.Z)({},h),{},{textStyle:"titleSmall",color:"primary",children:[W.toFixed(2),"x"]}));case"overperformance":var X=(0,u.d5)(A).times((0,u.gA)(null===E||void 0===E?void 0:E.baseApr).div(100)),H=(0,u.d5)(A).times((0,u.gA)(null===E||void 0===E?void 0:E.apy).div(100)),K=F?H.minus(X):null;return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:K,suffix:"/year"}));case"newApy":return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:U}));case"gain":return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:R?O:null}));case"fee":return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:R?z:null}));case"netGain":var Y=i.Z.minimum(N.minus(z),(0,u.d5)(O).minus(z));return(0,v.jsx)(o.Amount.Usd,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:R?Y:null}));case"coverage":var $=w(null===M||void 0===M?void 0:M.vaultConfig.Tranches.BB.address),q=$.tvl&&T?$.tvl.div(T).times(100):0;return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:q}));case"stakingPoolShare":if(!Z)return null;var J=(0,u.d5)(y).div(Z.stkIDLE.totalSupply.plus((0,u.d5)(y))).times(100);return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:J}));case"stkIDLE":case"stkIDLEAfterIncrease":return(0,v.jsx)(o.Amount,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary",suffix:" stkIDLE"},h),{},{value:y}));case"stakingApy":if(!Z)return null;var Q=(0,u.d5)(S).times(Z.maxApr);return(0,v.jsx)(o.Amount.Percentage,(0,a.Z)((0,a.Z)({textStyle:"titleSmall",color:"primary"},h),{},{value:Q}));default:return null}},f=function(e){var t,n=(0,c.w)().selectors.selectVaultById,r=e.assetId,i=e.action,o=(0,s.useMemo)((function(){return r&&n&&n(r)}),[r,n]),u=(0,s.useMemo)((function(){return(null===o||void 0===o?void 0:o.type)&&l.A[o.type]}),[o]);if(null===u||void 0===u||null===(t=u.dynamicActionFields)||void 0===t||!t[i])return null;var p=null===u||void 0===u?void 0:u.dynamicActionFields[i];return(0,v.jsx)(m.gC,{spacing:2,width:"100%",children:p.map((function(t){return(0,v.jsxs)(m.Ug,{pb:2,px:4,width:"100%",alignItems:"center",borderBottom:"1px solid",borderBottomColor:"divider",justifyContent:"space-between",children:[(0,v.jsx)(d.Translation,{component:m.xv,translation:"dynamicActionFields.".concat(t),textStyle:"captionSmall"}),(0,v.jsx)(x,(0,a.Z)((0,a.Z)({},e),{},{field:t}))]},"dynamicField_".concat(t))}))})}}}]);